<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>projects</title>
  <link rel="icon" type="image/x-icon" href="/images/logo.svg">
  <style>
    #preload-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background-color: black;
      z-index: 9999;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600&display=swap" rel="stylesheet">
  <script>
    const link = document.createElement('link');
    link.rel = 'stylesheet';
    link.href = '/styles.css?v=' + Date.now();
    link.onload = () => {
      document.getElementById('preload-overlay').style.display = 'none';
    };
    document.head.appendChild(link);
    
    const scriptEl = document.createElement('script');
    scriptEl.src = '/script.js?v=' + Date.now();
    document.head.appendChild(scriptEl);
    
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
          .then((registration) => {
            console.log('SW registered: ', registration);
          })
          .catch((registrationError) => {
            console.log('SW registration failed: ', registrationError);
          });
      });
    }

    const urlParams = new URLSearchParams(window.location.search);
    const message = urlParams.get('message');
    if (message) {
      alert(decodeURIComponent(message));
      const url = window.location.origin + window.location.pathname;
      window.history.replaceState({}, document.title, url);
    }
  </script>
</head>
<body>
  <div id="preload-overlay"></div>
  <div class="background"></div>
  <div class="gradient"></div>
  <div class="overlay"></div>
  <div class="main-content">
    <img src="/images/logo.svg" alt="Logo" class="logo" />
    <h1 class="title">projects</h1>
    <h2>all my web projects</h2>
    <img src="/images/div.svg" alt="Divider" class="divider" />
  </div>
  <div class="project-list" id="project-list">
    <!-- Project cards will generate from here -->
  </div>

  <div id="project-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-close" onclick="closeModal()">&times;</div>
      <div class="modal-video">
        <p class="video-label">Preview Video</p>
        <video id="modal-video" autoplay loop muted>
          <source src="" type="video/mp4">
          Your browser does not support the video tag.
        </video>
      </div>
      <div class="modal-body">
        <div class="modal-left">
          <h3 id="modal-title"></h3>
          <p id="modal-description"></p>
        </div>
        <div class="modal-right">
          <div class="modal-trait">
            <img src="/images/phone.svg" alt="Mobile" class="trait-icon">
            <span id="modal-mobile">Mobile Supported</span>
          </div>
          <div class="modal-trait">
            <img src="/images/clock.svg" alt="Version" class="trait-icon">
            <span id="modal-version">Version 1.0.0</span>
          </div>
          <div class="modal-trait">
            <img src="/images/calendar.svg" alt="Release" class="trait-icon">
            <span id="modal-release">Aug 5th</span>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button onclick="previousProject()" id="prev-btn-footer" class="nav-button">
          <svg viewBox="0 0 24 24">
            <path d="M15.41,7.41L14,6L8,12L14,18L15.41,16.59L10.83,12L15.41,7.41Z"/>
          </svg>
        </button>
        <button id="visit-button" class="visit-button" onclick="visitProject()">Visit</button>
        <button onclick="nextProject()" id="next-btn-footer" class="nav-button">
          <svg viewBox="0 0 24 24">
            <path d="M8.59,16.59L10,18L16,12L10,6L8.59,7.41L13.17,12L8.59,16.59Z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>
  <h3 class="bottom-heavy">more projects coming soon!</h3>
  <nav>
  <a href="/">
    <img src="/images/home.svg" alt="Home Icon" class="nav-icon" />
    <span>Home</span>
  </a>
  <a href="/projects/" class="active">
    <img src="/images/projects.svg" alt="Projects Icon" class="nav-icon" />
    <span>Projects</span>
  </a>
  <a href="/gallery">
    <img src="/images/gallery.svg" alt="Gallery Icon" class="nav-icon" />
    <span>Gallery</span>
  </a>
  
  <a href="/contact/">
    <img src="/images/contact.svg" alt="Contact Icon" class="nav-icon" />
    <span>Contact</span>
  </a>
  <a href="/settings/">
    <img src="/images/settings.svg" alt="Settings Icon" class="nav-icon" />
    <span>Settings</span>
  </a>
</nav>

<script>
  const projects = {
    site: {
      title: 'sandeepshenoy.dev',
      caption: 'the site you\'re currently on!',
      description: 'A modern, responsive online portfolio showcasing my projects, skills, and experiences. Built with HTML, CSS, and JavaScript.',
      thumbnail: '/images/thumbnails/site.png?version=1',
      video: 'dev.mov',
      url: '/',
      mobileSupported: true,
      version: 'Version 1.2.0',
      release: 'Released May 9th 2025',
      extraClasses: 'dynamic'
    },
    lumina: {
      title: 'lumina',
      caption: 'advanced conversational LLM',
      description: 'An advanced conversational LLM interface with a sleek design and powerful AI capabilities.',
      thumbnail: '/images/thumbnails/lumina.png?version=1.1',
      video: 'lumina-demo.mov',
      url: '/lumina/',
      mobileSupported: false,
      version: 'Version 1.1.0',
      release: 'Released Aug 4th 2025'
    },
    space: {
      title: 'space',
      caption: 'space shooter pygame project',
      description: 'An exciting space shooter game built with Python and Pygame. Navigate through space, destroy enemies, and survive as long as possible in this shooter.',
      thumbnail: '/images/thumbnails/space.png?version=1',
      video: 'space-demo.mov',
      url: '/spaceGame/web/',
      mobileSupported: false,
      version: 'Version 1.0.0',
      release: 'Released July 20th 2025'
    }
  };

  let currentProject = null;
  let projectKeys = [];

  function generateProjects() {
    const projectList = document.getElementById('project-list');
    projectList.innerHTML = '';
    projectKeys = Object.keys(projects);

    projectKeys.forEach(projectId => {
      const project = projects[projectId];
      
      const projectElement = document.createElement('div');
      projectElement.className = 'image-box project-box';
      projectElement.onclick = () => openModal(projectId);
      
      let imgClasses = '';
      if (project.extraClasses) {
        imgClasses = ` class="${project.extraClasses}"`;
      }
      
      projectElement.innerHTML = `
        <img src="${project.thumbnail}" alt="${project.title}"${imgClasses}>
        <div class="project-info">
          <h4 class="project-title">${project.title}</h4>
          <p class="project-caption">${project.caption}</p>
        </div>
      `;
      
      projectList.appendChild(projectElement);
    });
  }

  function updateModalContent(projectId) {
    const project = projects[projectId];
    
    document.getElementById('modal-title').textContent = project.title;
    document.getElementById('modal-description').textContent = project.description;
    
    const video = document.getElementById('modal-video');
    video.src = `/projects/${project.video}`;
    video.load();
    
    document.getElementById('modal-version').textContent = project.version;
    document.getElementById('modal-release').textContent = project.release;
    
    const mobileSpan = document.getElementById('modal-mobile');
    const visitButton = document.getElementById('visit-button');
    const isMobile = window.innerWidth <= 768;
    
    if (project.mobileSupported) {
      mobileSpan.textContent = 'Mobile Supported';
      mobileSpan.style.color = '#e0e6f0';
      visitButton.disabled = false;
      visitButton.textContent = 'Visit';
      visitButton.classList.remove('disabled');
    } else {
      mobileSpan.textContent = 'Mobile Unsupported';
      mobileSpan.style.color = '#e0e6f0';
      if (isMobile) {
        visitButton.disabled = true;
        visitButton.textContent = 'Unsupported';
        visitButton.classList.add('disabled');
      } else {
        visitButton.disabled = false;
        visitButton.textContent = 'Visit';
        visitButton.classList.remove('disabled');
      }
    }
    
    const currentIndex = projectKeys.indexOf(projectId);
    document.getElementById('prev-btn-footer').disabled = currentIndex === 0;
    document.getElementById('next-btn-footer').disabled = currentIndex === projectKeys.length - 1;
    
    setTimeout(() => {
      video.play().catch(e => console.log('Video autoplay prevented:', e));
    }, 100);
  }

  function openModal(projectId) {
    currentProject = projectId;
    
    const modal = document.getElementById('project-modal');
    const modalContent = modal.querySelector('.modal-content');
    
    modal.style.display = 'flex';
    document.body.style.overflow = 'hidden';
    
    updateModalContent(projectId);
    
    setTimeout(() => {
      modal.classList.add('show');
      modalContent.classList.add('show');
    }, 10);
  }

  function nextProject() {
    const currentIndex = projectKeys.indexOf(currentProject);
    if (currentIndex < projectKeys.length - 1) {
      currentProject = projectKeys[currentIndex + 1];
      updateModalContent(currentProject);
    }
  }

  function previousProject() {
    const currentIndex = projectKeys.indexOf(currentProject);
    if (currentIndex > 0) {
      currentProject = projectKeys[currentIndex - 1];
      updateModalContent(currentProject);
    }
  }

  function closeModal() {
    const modal = document.getElementById('project-modal');
    const modalContent = modal.querySelector('.modal-content');
    
    modal.classList.remove('show');
    modalContent.classList.remove('show');
    
    setTimeout(() => {
      modal.style.display = 'none';
      document.body.style.overflow = 'auto';
      document.getElementById('modal-video').pause();
    }, 300);
  }

  function visitProject() {
    if (currentProject && !document.getElementById('visit-button').disabled) {
      window.location.href = projects[currentProject].url;
    }
  }

  document.getElementById('project-modal').addEventListener('click', function(e) {
    if (e.target === this) {
      closeModal();
    }
  });

  document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
      closeModal();
    } else if (currentProject && document.getElementById('project-modal').style.display === 'flex') {
      if (e.key === 'ArrowLeft') {
        previousProject();
      } else if (e.key === 'ArrowRight') {
        nextProject();
      }
    }
  });

  window.addEventListener('resize', function() {
    if (currentProject) {
      const project = projects[currentProject];
      const visitButton = document.getElementById('visit-button');
      const isMobile = window.innerWidth <= 768;
      
      if (!project.mobileSupported && isMobile) {
        visitButton.disabled = true;
        visitButton.textContent = 'Unsupported';
        visitButton.classList.add('disabled');
      } else {
        visitButton.disabled = false;
        visitButton.textContent = 'Visit';
        visitButton.classList.remove('disabled');
      }
    }
  });

  const PERSPECTIVE_SETTINGS = {
    hoverIntensity: 30,
    scaleAmount: 1.05,
    baseRotateYRange: 20,
    baseRotateXMax: 12
  };

  function setup3DEffects() {
    const projectBoxes = document.querySelectorAll('.project-box');
    
    projectBoxes.forEach(box => box.offsetHeight);
    
    requestAnimationFrame(() => {
      projectBoxes.forEach(box => {
        updateCardPerspective(box);
        
        box.addEventListener('mousemove', (e) => {
          const rect = box.getBoundingClientRect();
          const centerX = rect.left + rect.width / 2;
          const centerY = rect.top + rect.height / 2;
          
          const mouseX = e.clientX;
          const mouseY = e.clientY;
          
          const rotateX = (mouseY - centerY) / rect.height * -PERSPECTIVE_SETTINGS.hoverIntensity;
          const rotateY = (mouseX - centerX) / rect.width * PERSPECTIVE_SETTINGS.hoverIntensity;
          
          const basePerspective = getBasePerspective(box);
          
          box.style.transform = `
            ${basePerspective}
            rotateX(${rotateX}deg) 
            rotateY(${rotateY}deg) 
            scale(${PERSPECTIVE_SETTINGS.scaleAmount})
          `;
        });
        
        box.addEventListener('mouseleave', () => {
          const basePerspective = getBasePerspective(box);
          box.style.transform = basePerspective;
        });
      });
    });
  }
  
  function getBasePerspective(box) {
    const rect = box.getBoundingClientRect();
    const viewportHeight = window.innerHeight;
    
    // Ensure we have valid dimensions before calculating
    if (rect.height === 0 || viewportHeight === 0) {
      return 'rotateY(-15deg) rotateX(5deg)'; // fallback to default
    }
    
    const cardCenter = rect.top + rect.height / 2;
    const verticalPosition = Math.max(0, Math.min(1, cardCenter / viewportHeight));
    
    const baseRotateY = -15 + (verticalPosition * PERSPECTIVE_SETTINGS.baseRotateYRange);
    const baseRotateX = verticalPosition * PERSPECTIVE_SETTINGS.baseRotateXMax;
    
    return `rotateY(${baseRotateY}deg) rotateX(${baseRotateX}deg)`;
  }
  
  function updateCardPerspective(box) {
    const basePerspective = getBasePerspective(box);
    box.style.transform = basePerspective;
  }
  
  window.addEventListener('scroll', () => {
    const projectBoxes = document.querySelectorAll('.project-box');
    projectBoxes.forEach(updateCardPerspective);
  });
  
  window.addEventListener('resize', () => {
    const projectBoxes = document.querySelectorAll('.project-box');
    projectBoxes.forEach(updateCardPerspective);
  });

  document.addEventListener('DOMContentLoaded', () => {
    generateProjects();
    // Wait for images to load and layout to stabilize
    setTimeout(() => {
      setup3DEffects();
    }, 200);
  });
</script>

</body>
</html>
