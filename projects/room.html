<!DOCTYPE html>
<html>
<head>
  <title>Room Console</title>
  <script src="https://js.pusher.com/8.4.0/pusher.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <style>
    body { background: #111; color: #fff; font-family: sans-serif; text-align: center; }
    .ports { display: flex; justify-content: center; gap: 1em; margin: 1em; }
    .port { background: #222; padding: 1em; border-radius: 8px; }
    .log { background: #000; margin: 2em auto; padding: 1em; max-width: 600px; border-radius: 8px; text-align: left; }
  </style>
</head>
<body>
  <h1>Room Console</h1>
  <div class="ports" id="ports"></div>
  <div class="log" id="log">Waiting for inputs...</div>

  <script>
    const roomId = new URLSearchParams(location.search).get("room") || "default";
    const portsContainer = document.getElementById("ports");

    for (let i = 1; i <= 3; i++) {
      const portId = `${roomId}-port${i}`;
      const controllerUrl = `${location.origin}/controller.html?room=${roomId}&port=${portId}`;
      
      const portEl = document.createElement("div");
      portEl.className = "port";
      portEl.innerHTML = `<div><strong>Port ${i}</strong></div><canvas id="qr-${i}"></canvas>`;
      portsContainer.appendChild(portEl);

      QRCode.toCanvas(document.getElementById(`qr-${i}`), controllerUrl);
    }

    // Connect to Pusher
    const pusher = new Pusher("YOUR_PUSHER_KEY", { cluster: "mt1" });
    const channel = pusher.subscribe(`room-${roomId}`);

    channel.bind("input", (data) => {
      const logEl = document.getElementById("log");
      logEl.innerHTML = `<pre>${JSON.stringify(data, null, 2)}</pre>` + logEl.innerHTML;
    });
  </script>
</body>
</html>
